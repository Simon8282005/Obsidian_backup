# Stat bonuses and penalties （亏损

下面的代码是在 `BattlerStats.gd` 里的

```python
# A list of all properties that can receive bonuses.
const UPGRADABLE_STATS = [
	"max_health", "max_energy", "attack", "defense","speed" , "hit_chance", "evasion"
]

# The property below stores a list of modifiers for each property listed in
# `UPGRADABLE_STATS`.
# The value of a modifier can be any floating-point value, positive or negative.
var _modifiers := {}


# Initializes keys in the modifiers dict, ensuring they all exist.
func _init() -> void:
	for stat in UPGRADABLE_STATS:
		# For each stat, we create an empty dictionary.
		# Each upgrade will be a unique key-value pair.
		_modifiers[stat] = {}
```

由于需要计算各种各样的 bonus 和 penalties，所以为了避免麻烦（果然就是要懒 XDDD ）就使用了 字典来处理这些数据，每一个字典都有各自*唯一*的*键值对*

```python
# Calculates the final value of a single stat. That is, its based value
# with all modifiers applied.
# We reference a stat property name using a string here and update
# it with the `set()` method.
func _recalculate_and_update(stat: String) -> void:
	# All our property names follow a pattern: the base stat has the
	# same identifier as the final stat with the "base_" prefix.
	var value = get("base_" + stat)
	# We get the array of modifiers corresponding to a stat.
	var modifiers: Array = _modifiers[stat]
	for modifier in modifiers:
		value += modifier
	
	# This line ensures the final stat cannot be negative.
	value = max(value, 0.0)
	# Here's where we assign the value to the stat. For instance,
	# if the `stat` argument is "attack", this is like writing
	# attack = value
	set(stat, value)
```

现在这个一直报错的 function 终于消停了 XDDD

`max`